# Telegram Chat Export Participants Bot

Telegram-бот, который принимает **экспорт истории чата Telegram (JSON/HTML)** и формирует список участников (по авторам сообщений) и упоминаний.  
Если участников меньше 50 — бот отправляет список в чат. Если 50 и больше — отправляет **Excel-файл**.

---

## Возможности

- Принимает **до 10 файлов** экспорта истории чата
- Поддерживает форматы экспорта Telegram Desktop:
  - ✅ JSON
  - ✅ HTML
- Извлекает **всех уникальных авторов сообщений** (участников)
- Исключает:
  - удалённые аккаунты
  - дубли участников
- Выдаёт результат по правилу:
  - `< 50` участников → список в сообщении
  - `>= 50` участников → Excel (список в чат **не** отправляется)

---

## Как пользоваться ботом (для пользователя)

1) Напишите боту `/start`  
2) Отправьте файл(ы) экспорта (`.json` или `.html`)  
3) Нажмите кнопку **«Готово (обработать)»**  
4) Получите результат:
   - список участников (если их < 50)
   - или Excel (если участников ≥ 50)

Кнопка **«Сброс»** очищает очередь файлов и позволяет начать заново.

---

## Формат результата

### Если участников < 50
Бот отправляет список участников (username, если доступен, иначе имя):
- **Participants**
  - `export_date`
  - `username`
  - `full_name`
  - `bio/about`
- **Mentions**
  - `username_mentioned`

---

## Ограничения (важно)

### 1) Лимит размера файлов Telegram Bot API
Telegram может не позволить боту скачать слишком большой файл экспорта.  
В этом случае бот выдаст ошибку вида: **“file is too big”**.

**Как избежать:**
- экспортируйте **без медиа**
- экспортируйте меньший период/диапазон сообщений
- при необходимости делайте несколько экспортов по периодам (до 10 файлов)

### 2) Поле `username` может отсутствовать
В стандартном экспорте Telegram `username` автора **часто не сохраняется**.  
В таком случае поле `username` будет пустым, а идентификация идёт по `full_name` / `user_id` (если доступно).

### 3) Поле `bio/about` обычно недоступно
Стандартный экспорт истории чата **не содержит Bio/About**, и Telegram Bot API не позволяет массово получать био произвольных пользователей.  
Поэтому колонка `bio/about` остаётся пустой.

### 4) HTML экспорт менее стабилен
Структура HTML экспорта может отличаться в зависимости от версии Telegram Desktop.  
**Рекомендуемый формат — JSON.**

---

## Конфиденциальность и данные

- Файлы экспорта **не сохраняются** в постоянное хранилище
- Обработка происходит **в памяти** (на лету)
- После обработки состояние бота очищается
- В процессе ожидания “Готово” бот хранит только `file_id` документов от Telegram, чтобы потом скачать их для обработки

---

## Запуск проекта

### Требования
- Python 3.11+ (для локального запуска)
- Docker / Docker Compose (для запуска в контейнере)

---

## Локальный запуск (без Docker)

```bash
pip install -r requirements.txt
python -m app.main
```
---

## Запуск в Docker
